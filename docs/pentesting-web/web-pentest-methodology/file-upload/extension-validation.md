# Extension Validation

## Theory

Filename validation is when the server validates the file being uploaded by checking its extension, this validation occurs based on many methods, but two of the most popular methods are blacklist file extensions and whitelist file extensions.

Blacklist file extensions is a type of protection where only specific extensions are rejected from the server, such as php, aspx. While whitelist file extensions is exactly the opposite, only some file extensions are allowed to be uploaded to the server, such as jpg, jpeg, gif.

## Practice

### File Name Bypass

* [ ] Some file name validation methods can be bypassed by uploading a different unpopular extension or using some tricks when uploading the file to bypass this type of validation:

| Type                   | Extension                                                                                                                |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| php                    | .php, .php2, .php3, .php4, .php5, .php6, .php7, .phps, .phps, .pht, .phtm, .phtml, .pgif, .shtml, .htaccess, .phar, .inc |
| asp                    | .asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml       |
| jsp                    | .jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action                                                                       |
| Coldfusion             | .cfm, .cfml, .cfc, .dbm                                                                                                  |
| Flash                  | .swf                                                                                                                     |
| perl                   | .pl, .pm, .cgi, .lib                                                                                                     |
| Erlang Yaws Web Server | .yaws                                                                                                                    |

### Bypass file extension checks

* [ ] If applicable, check the above extensions. Check them also by using some capital letters: `.pHp, .pHP5, .PhAr`, etc.
* [ ] Check **adding a valid extension before** the run extension (use also the above extensions): `file.png.php`, `file.jpg.Phtml`.
* [ ] Try to add special characters at the end. You can use Burp to force all ascii and Unicode characters. (Note that you can also try to use the previously mentioned extensions):

```
file.php%20
file.php%0a
file.php%00
file.php%0d%0a
file.php/
file.php.\
file.
file.php....
file.pHp5...
```

* [ ] Try to bypass the protections by fooling the server-side extension parser with techniques like duplicating the extension or adding junk data (null bytes) between extensions. You can also use the above extensions to prepare a better payload:

```
file.png.php
file.png.pHp5
file.php%00.png
file.php\x00.png
file.php%0a.png
file.php%0d%0a.png
flile.phpJunk123png
```

* [ ] Add another layer of extensions to the above check: `file.png.jpg.php`, `file.php%00.png%00.jpg`.
* [ ] Try to put the exec extension before the valid extension and pray that the server is misconfigured. **(useful for exploiting Apache misconfigurations where anything with a .php extension, but not necessarily ending in .php** will execute code): `file.php.png`.

### Whitelist bypass with null bytes

```
shell.php.jpg -> http://10.10.10.10/shell.php%00.jpg
```

### Others bypass

* Create a file called `shell.php.jpg` and with Burpsuite intercepting, we remove the `.jpg` and that's it. We should now have the `shell.php`.
* Another rare method of bypassing is to add a dot to our file â†’ `shell.php.`
