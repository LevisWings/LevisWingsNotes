# SSRF

## Server Side Request Forgery (SSRF)

In a server-side request forgery (SSRF) attack, the attacker can abuse server functionality to read or update internal resources. The attacker can provide or modify a URL to which code running on the server will read or send data, and by carefully selecting URLs, the attacker can read server configuration such as AWS metadata, connect to internal services such as http enabled, databases, or make publish requests towards internal services that are not intended to be exposed.

### Types of SSRF (detection)

Potential SSRF vulnerabilities can be detected in web applications in many different ways. Here is an example of common places to look:

![When a full URL is used in an address bar parameter.](../../../.gitbook/assets/ssrf\_1.png)

![A hidden field in a form.](../../../.gitbook/assets/ssrf\_2.png)

![A partial URL such as, for example, just the host name.](../../../.gitbook/assets/ssrf\_3.png)

![Only the path of the URL.](../../../.gitbook/assets/ssrf\_4.png)

![Only the URL path in the source code.](../../../.gitbook/assets/ssrf\_5.png)

### Blind SSRF



### More payloads

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery" %}

{% embed url="https://vulp3cula.gitbook.io/hackers-grimoire/exploitation/web-application/ssrf#attacking-aws-with-ssrf" %}

### SSRF PoC

```php
<?php
    if (isset($_POST['url'])) 
    { 
        $content = file_get_contents($_POST['url']); 
        $filename = './images/'.rand().'img1.jpg'; 
        file_put_contents($filename, $content); 
        echo $_POST['url'].""; 
        $img = "<img src=\"".$filename."\"/>"; 
    } 
    echo $img; 
?>
```

```php
<?php 
    function GetFile($host,$port,$link) 
    { 
        $fp = fsockopen($host, intval($port), $errno, $errstr, 30); 
        if (!$fp) { 
            echo "$errstr (error number $errno) \n"; 
        } else { 
            $out = "GET $link HTTP/1.1\r\n"; 
            $out .= "Host: $host\r\n"; 
            $out .= "Connection: Close\r\n\r\n"; 
            $out .= "\r\n"; 
            fwrite($fp, $out); 
            $contents=''; 
            while (!feof($fp)) { 
                $contents.= fgets($fp, 1024); 
        } 
        fclose($fp); 
        return $contents; 
        } 
    }
?>
```

```php
<?php 
    if (isset($_POST['url']))
    {
        $link = $_POST['url'];
        $curlobj = curl_init();
        curl_setopt($curlobj, CURLOPT_POST, 0);
        curl_setopt($curlobj,CURLOPT_URL,$link);
        curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, 1);
        $result=curl_exec($curlobj);
        curl_close($curlobj);

        $filename = './curled/'.rand().'.txt';
        file_put_contents($filename, $result); 
        echo $result;
    }
?>
```

{% embed url="https://ibreak.software/2012/11/cross-site-port-attacks-xspa-part-1" %}
