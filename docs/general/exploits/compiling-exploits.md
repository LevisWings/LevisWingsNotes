# Compiling exploits

## Things to keep in mind:

* Options of the compiler to use (it is usually in the code itself or manual).
* Architecture of the victim machine (32-bit or 64-bit).
* Steps to perform on the victim machine
* Code modifications

## Basic compilation (Linux)

```bash
# More or less, this is what a compilation for a Linux exploit looks like:
gcc filename.c -o executablename
```

### 32-bit/64-bit exploits (Linux)

{% hint style="info" %}
This section is to know how to compile on a different architecture than our current computer. For example, if I have a 64-bit machine and I need an executable for a 32-bit computer, I will have to compile it on a system with that architecture or add a flag in the command (the latter is the one we are going to see).
{% endhint %}

32-bit is usually represented by `i686` and 64-bit is usually represented by `x86_64`. If a C compiler is missing or inaccessible on your victim machine, you can compile the exploits on your Kali machine, but you need some additional libraries in Kali:

```bash
# Ubuntu/Debian:
apt-get install gcc-multilib
apt-get install g++-multilib
# Arch Linux:
https://noraj.gitlab.io/the-hacking-trove/Tools/gcc/
```

Depending on the architecture you need, you will need to add a flag to your compile command:

```bash
# 32 bits:
gcc -m32 filename.c -o executablename
# 64 bits:
gcc -m64 filename.c -o executablename
```

## Cross-compiling

You will probably discover at some point that you cannot compile Windows C exploits on a Kali machine and expect them to work. This is where cross-compiling tools come in, but don't expect them to work perfectly. There are all sorts of silly platform quirks that still get in the way, such as missing libraries. When cross-compiling, be prepared to Google a lot of error messages.

Download and install a cross compiler for Linux:

```bash
# Ubuntu/Debian
sudo apt-get install mingw-w64
sudo apt install gcc-mingw-w64
# Arch Linux
sudo pacman -S mingw-w64-gcc
```

### Compilation for Windows

{% hint style="info" %}
In some cases, we may get an error because it does not find a certain library. In this case, we must search for the error in Google and sometimes, we will have to add a parameter to our command for it to work.
{% endhint %}

```bash
x86_64-w64-mingw32-gcc shell.c -o shell.exe # 64 bits
i686-w64-mingw32-gcc shell.c -o shell.exe # 32 bits
```

## Python on Windows

Interestingly, some popular Windows exploits, such as MS11-080, are written in Python (why?). To use them, you will need to create a separate executable from the python file. This is done by installing PyWin32 on a Windows machine and then the PyInstaller module.

Create a Windows PE executable:

```bash
python pyinstaller.py --onefile ms11-080.py
```

The executable can then be transferred to the victim machine and run.

## References

{% embed url="https://null-byte.wonderhowto.com/how-to/use-mingw-compile-windows-exploits-kali-linux-0179461" %}
