# 3128 - Squid

## Theory

**Squid** is a caching and forwarding HTTP web proxy. It has a wide variety of uses, including speeding up a web server by caching repeated requests, caching web, DNS and other computer network lookups for a group of people sharing network resources, and aiding security by filtering traffic. Although primarily used for HTTP and FTP, Squid includes limited support for several other protocols including Internet Gopher, SSL, TLS and HTTPS. Squid does not support the SOCKS protocol, unlike Privoxy, with which Squid can be used in order to provide SOCKS support.

## Practice

### Web Proxy

You can try to set this discovered service as proxy in your browser. However, if it's configured with HTTP authentication you will be prompted for usernames and password.

To use Squid as a web proxy, we can configure it with [FoxyProxy](../general/proxies-and-pivoting/foxy-proxy.md#http-proxy), proxychains or curl.

{% tabs %}
{% tab title="proxychains" %}
{% code title="/etc/proxychains.conf" %}
```bash
http <IP> <PORT>
http <IP> <PORT> <USERNAME> <PASSWORD> # With authentication.
```
{% endcode %}

```bash
proxychains -q ...
```
{% endtab %}

{% tab title="curl" %}
```bash
curl --proxy http://<IP>:<PORT> <URL>
curl --proxy http://<USER>:<PASS>@<IP>:<PORT> <URL> # With authentication.
```
{% endtab %}
{% endtabs %}

### Verify authentication

Squid proxies sometimes require user authentication before they can be used. We can find this out using **tshark** or **wireshark**:

```bash
tshark -i tun0 -w Capture.cap 2>/dev/null
```

Then, **load a page using the previously configured Squid proxy** and **stop** the packet capture with `Ctrl + C`. Finally, we analyze the data in the .cap file with tshark and try to see if it asks for authentication anywhere:

```bash
tshark -r Capture.cap -Y "http" 2>/dev/null
tshark -r Capture.cap -Y "http" -Tfields -e "tcp.reassembled.data" 2>/dev/null | xxd -ps -r
```

If you see a message like "**Proxy Authentication Required**", with a **407 status code**, you most likely need to authenticate.

### Nmap proxified

You can also try to abuse the proxy to **scan internal ports proxifying nmap**.

Configure proxychains to use the squid proxy adding he following line at the end of the proxichains.conf file: `http 10.10.10.10 3128`

Then run nmap with proxychains to **scan the host from local**:&#x20;

```bash
proxychains nmap -sT -n -Pn -p- 127.0.0.1
```
