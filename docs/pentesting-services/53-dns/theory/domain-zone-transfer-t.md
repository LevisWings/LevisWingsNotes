# Domain zone transfer (T)

Many organizations generally have DNS servers of their own, and if they are not properly configured, there can be a vulnerability called zone transfer, where we can get IP addresses, hostnames, etc.

As an Internet addressing system, it goes without saying how important DNS is. As a result of this importance, it is good practice to have at least two DNS servers containing the records for a "zone" (or domain, in normal terms). This means that if one server goes down, there is still at least one other server that contains the records for the domain; but this poses a problem: how do you update the DNS records for the zone without having to go update each server manually? The answer is something called "Zone Transfer". In short: one server is configured as the "master" (or primary) DNS server. This server contains the primary records for the zone. In BIND9, the zone configuration files for a primary server look something like the following:

{% code title="BIND Primary Zone Example Config" %}
```shell
zone "example.com" IN {
    type master;
    file "/etc/bind/db.example.com";
    allow-query { any; };
    allow-transfer { 172.16.0.2; };
}
```
{% endcode %}

This defines a master zone for the domain [example.com](http://example.com), tells BIND to read records from a file named `/etc/bind/db.examples.com` and accept queries from anywhere. More importantly, it also allows to transfer the zone to an IP address: **172.16.0.2.**.

In addition to the primary DNS server, one or more "slave" (or secondary) DNS servers are configured. These will have a zone file that looks like this:

```shell
zone "example.com" IN {
    type slave;
    file "/etc/bind/db.example.com";
    masters { 172.16.0.1; };
    allow-transfer { none; };
};
```

This defines a slave zone by setting the IP address of the primary DNS server in the masters `{};` directive.

So what are zone transfers? As you might have guessed, zone transfers allow secondary DNS servers to replicate a zone's records from a primary DNS server. At frequent intervals (controlled by the Time To Live value of the zone), the secondary server(s) will query a serial number of the zone to the primary server. If the number is greater than the number that the secondary servers have stored for the zone, then they will initiate a zone transfer, requesting all the records that the primary server has for that zone and making a copy locally.

In some configurations there may also be a "DNS Notification List" on the primary DNS server. If in place, the primary server will notify all secondary servers whenever a change is made, prompting them to request a zone transfer.

How can we take advantage of this? What if one of the servers does not specify which IP addresses can request a zone transfer? What if a DNS server has an entry in the zone configuration that looks like this: `allow-transfer { any; };`?

Instead of specifying a specific IP address (or set of IP addresses), the server allows any remote machine to request all records in the zone. Believe it or not, this misconfiguration is even easier to perform in the Windows GUI DNS service manager.

This means that if the server is configured incorrectly we can dump all the domain records - including the subdomains we are looking for here!

We can legally test it on this page: [zonetransfer.me](http://zonetransfer.me)
