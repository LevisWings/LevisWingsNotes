# Reconnaissance (DNS)

## Banner Grabbing

DNS does not have a "banner" to grab. The closest equivalent is a magic query for this. CHAOS TXT which will work on most BIND nameservers. You can perform this query using dig:

```bash
dig version.bind CHAOS TXT @DNS
```

If that doesn't work, you can use fingerprinting techniques to determine the version of the remote server - the `fpdns` tool ([https://github.com/kirei/fpdns](https://github.com/kirei/fpdns)) is one option for that, but there are others.

You can also get the banner with a **nmap** script:

```bash
--script dns-nsid
```

## Get more information

{% hint style="info" %}
**DNS\_IP** is the IP address of a DNS server. In real environments, we can use **1.1.1.1** (CloudFlare's DNS server). In CTF, we can use the IP of a machine that has the DNS service. We can also use the **NS** (Name Server).
{% endhint %}

{% tabs %}
{% tab title="dig" %}
```bash
dig ANY @<DNS_IP/NS> <DOMAIN>     # Any information
dig A @<DNS_IP/NS> <DOMAIN>       # Regular DNS request
dig AAAA @<DNS_IP/NS> <DOMAIN>    # IPv6 DNS request
dig TXT @<DNS_IP/NS> <DOMAIN>     # Information
dig MX @<DNS_IP/NS> <DOMAIN>      # Emails related
dig TXT <DOMAIN/NS>               # TXT and SPF record
dig TXT _dmarc.<DOMAIN>           # DMARC record
dig NS @<DNS_IP/NS> <DOMAIN>      # DNS that resolves that name
dig -x <DNS_IP> @<DNS_IP>         # Reverse lookup (interesting)
dig -x <DNS_IPv6_> @<DNS_IP>      # reverse IPv6 lookup

#Use [-p PORT] or -6 (to use ivp6 address of dns)
```
{% endtab %}

{% tab title="nslookup" %}
```bash
# Interactive mode:
nslookup
> SERVER <DNS_IP> #Select dns server
> <DOMAIN>
> 127.0.0.1 #Reverse lookup of 127.0.0.1, maybe...
> set type=ANY
> <DOMAIN>

# No interactive:
nslookup -type=ANY <DOMAIN>
nslookup -type=MX <DOMAIN> <DNS_IP>
```
{% endtab %}

{% tab title="dnsrecon" %}
`dnsrecon` is a DNS recognition tool: AXFR, DNS record enumeration, TLD expansion, wildcard resolution, subdomain brute force, PTR record lookup, cache record verification.

```bash
dnsrecon -d <DOMAIN> -t crt # Obtain subdomains from crt.sh
dnsrecon -d <DOMAIN> -t std # SOA, NS, A, AAAA, MX and SRV.
# Subdomain brute force:
dnsrecon -d <DOMAIN> -t brt 
dnsrecon -t brt -d "<DOMAIN>" -n "nameserver.com" -D "<WORDLIST>"
```
{% endtab %}

{% tab title="host" %}
```bash
host <DOMAIN> # If we indicate a domain, we will obtain its IPs.
host -t <TYPE QUERY> <DOMAIN> # Indicate the type of query to a domain: MX, NS, etc.
for i in $(cat <SUBDOMAINS_WORDLIST>); do host $i.<DOMAIN>; done | grep -v "not found"
```
{% endtab %}

{% tab title="dnsenum" %}
Dnsenum is a multithreaded perl script to enumerate DNS information of a domain and to discover non-contiguous ip blocks. The main purpose of Dnsenum is to gather as much information as possible about a domain.

```bash
dnsenum <DOMAIN>
# Brute force subdomain:
dnsenum --dnsserver <IP> --threads 50 -f /opt/SecLists/Discovery/DNS/subdomains-top1million-110000.txt
```
{% endtab %}

{% tab title="Nmap" %}
### Nmap

```bash
# Perform enumeration actions:
nmap -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP> 

```

### Metasploit

```bash
auxiliary/gather/enum_dns # Perform enumeration actions
```

### WHOIS

{% content-ref url="../43-whois.md" %}
[43-whois.md](../43-whois.md)
{% endcontent-ref %}

### Threat Intelligence Platform

{% embed url="https://threatintelligenceplatform.com" %}
{% endtab %}
{% endtabs %}

## Config files

```bash
/etc/hosts
host.conf
resolv.conf
named.conf
```
