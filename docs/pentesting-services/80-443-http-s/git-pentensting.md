# Git Pentensting

## Theory

Git is a [**free and open source**](http://www.git-scm.com/about/free-and-open-source) **distributed version control system** designed to handle everything from small to very large projects with speed and efficiency.

Every git working directory is **a full-fledged repository** with complete history and full version-tracking capabilities, independent of network access or a central server.

### Version Control System

Version control systems are a category of software tools that helps in recording changes made to files by keeping a track of modifications done to the code.

### Git repository manager

A repository manager is useful for collaborative development. You want others in your organization to be able to easily find, comment and contribute to your code base. Without a repository manager, others have to know that your project exists.

There are many Git repository managers such as GitHub, GitLab, Gitstack, Gitea, Gogs, etc.

### Offensive approach

When attacking an application, obtaining the source code of the application can be extremely useful for building an exploit. This is because some bugs, such as SQL injections, are much easier to find using static code analysis compared to black box testing. Getting the source code of an application also usually means getting hold of developer comments, hard-coded API keys and other sensitive data.

As we saw earlier, git repositories usually contain an application's source code and change history, making it very juicy for attackers.

## Practice

### Clone repository

Regardless of the repository manager used, we can clone the repository with git if we have the HTTP/s or SSH address of the repository, ending in `.git`:

{% tabs %}
{% tab title="HTTP/S" %}
```bash
# Syntax:
git clone https://<DOMAIN>/<USERNAME>/<REPOSITORY_NAME>.git
# Example:
git clone https://github.com/byt3bl33d3r/CrackMapExec.git
git -c clone https://github.com/byt3bl33d3r/CrackMapExec.git # Ignore cert
```
{% endtab %}

{% tab title="SSH" %}
The first thing we are going to do is to create an SSH key pair:

```bash
ssh-keygen -f $(pwd)/test_key
```

Next, **independent of the repository manager**, let's go to the **Settings tab** and look for an option called "**SSH Keys**", "**Deploy keys**", or something related to SSH keys. There we will **paste the content of our public key** (in this case, test\_key.pub) and **add it to the repository**:

![Example with the Gitea repository manager](../../.gitbook/assets/ssh\_clone2.png)

Then, we go to the main page of the repository, where we will find the option to clone by SSH:

![Example with the Gitea repository manager](../../.gitbook/assets/ssh\_clone1.png)

Finally, we will clone the repository using the private key (test\_key) as follows:

```bash
ssh-agent bash -c 'ssh-add test_key; git clone <PASTE>'
ssh-agent bash -c 'ssh-add test_key; git clone git@git.git-and-crumpets.thm:scones/cant-touch-this.git' # Example
```
{% endtab %}
{% endtabs %}

### Dump a git repository from a website

On rare occasions, the developer may make the mistake of placing a git repository that is accessible by the web application. Even if we have forbidden access (status code 403), we can rebuild the entire repository and even access the commits.

{% tabs %}
{% tab title="gitdumper.sh" %}
```bash
wget https://raw.githubusercontent.com/internetwache/GitTools/master/Dumper/gitdumper.sh
bash gitdumper.sh '<URL>/.git/' -o repo
```
{% endtab %}

{% tab title="git-dumper" %}
```bash
sudo pip3 install git-dumper
sudo git-dumper <URL>/.git <DIRECTORY>
```
{% endtab %}
{% endtabs %}

### Rebuild git repository

On rare occasions, we may encounter git repositories that only have the "`.git`" directory. This is sufficient to rebuild all the objects and display the commits.

![Example of a git repository without content but with the special directory ".git".](../../.gitbook/assets/git\_repository.png)

`extractor.sh` (from [GitTools](https://github.com/internetwache/GitTools)) is a script that attempts to retrieve incomplete git repositories:

```bash
git clone https://github.com/internetwache/GitTools
cd GitTools/Extractor
bash extractor.sh <path/to/.git> <DESTINATION DIRECTORY>
```

## Git Enumeration

### .gitignore

The `.gitignore` file is a text file that tells Git which files or folders to ignore in a project. For example, the following .gitignore file tells us that the **auth.py** and **db.py** files were omitted:

```bash
> cat .gitignore

auth.py
db.py
```

### Commits

There are many ways to navigate between the different commits in a git repository.

#### Just show differences

```bash
git diff <COMMIT>
```

### Git leaks

Sometimes git repositories tend to leak, either directly or indirectly. If we are dealing with a huge repository, it can be a bit frustrating to search every file for a possible leak. That's why there are tools that can automate this search, such as [gitleaks](https://github.com/zricethezav/gitleaks) or [trufflehog](https://github.com/trufflesecurity/truffleHog).

{% tabs %}
{% tab title="gitleaks" %}
[gitleaks](https://github.com/zricethezav/gitleaks) scans git repos (or archives) for secrets using regex and entropy.

```bash
cd <path/to/repo>
gitleaks -v --repo-path=$(pwd)
```
{% endtab %}

{% tab title="trufflehog" %}
[trufflehog](https://github.com/trufflesecurity/truffleHog) searches for secrets in git repositories, digging deep into the commit and branch history. This is effective for finding accidentally committed secrets.

```bash
cd <path/to/repo>
trufflehog file://$(pwd)
```
{% endtab %}
{% endtabs %}
