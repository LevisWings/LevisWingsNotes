# Enumeration (MySQL)

### Basic

```sql
# Enumeration dbs, tables and columns:
show databases;
use <database>;
show tables;
describe <table_name>;

# Enumeration privileges:
select grantee, table_schema, privilege_type FROM schema_privileges; # Exact privileges
select user,file_priv from mysql.user where user='root'; # File privileges
select version(); # version
select @@version(); # version
select user(); #User
select database(); #database name

#Try to execute code
select do_system('id');
\! sh
```

### [MySQL injection](../../pentesting-web/web-pentest-methodology/sql-injection/mysql-injection.md)

### Hash format

Remember that if we find a hash of this form: `*EA031893AA21444B170FC2162A56978B8CEECE18`, we need to add the username next to that hash to decrypt it:

```bash
<USERNAME>:*EA031893AA21444B170FC2162A56978B8CEECE18
```

If for some reason john or hashcat do not identify the type of hash, then we must add a hash similar to the one we put in:

```bash
root:*EA031893AA21444B170FC2162A56978B8CEECE18
asdf:*EA031893AA21444B170FC2162A56978B8CEECE18 # Same length
```

### SQL File Analyze

If we have a MySQL file, we can open **mysql** or **mariadb**:

```bash
mysql -u <USER> -p
mysql> source <FILE>.sql
```

### MySQL client in Python

```python
#!/usr/bin/python3
import pymysql.cursors

# Connect to the database
connection = pymysql.connect(host='localhost',
                             user='user',
                             password='passwd',
                             db='db_name',
                             cursorclass=pymysql.cursors.DictCursor)

try:
    # Insert SQL data:
    with connection.cursor() as cursor:
        # Create a new record
        sql = "INSERT INTO `users` (`email`, `password`) VALUES (%s, %s)"
        cursor.execute(sql, ('webmaster@python.org', 'very-secret'))
    # connection is not autocommit by default. So you must commit to save
    # your changes.
    connection.commit()

    # SQL Queries:
    with connection.cursor() as cursor:
        sql = "<SQL_QUERY>"
        cursor.execute(sql)
        #result = cursor.fetchone() # Read a single record
        result = cursor.fetchall() # Read all records
        print(result)
finally:
    connection.close()
```

Reference: [http://www.nonbleedingedge.com/cheatsheets/pymysql.html](http://www.nonbleedingedge.com/cheatsheets/pymysql.html)
