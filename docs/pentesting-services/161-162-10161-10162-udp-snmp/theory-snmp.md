# Theory (SNMP)

SNMP - **Simple Network Management Protocol** is a protocol used to monitor different devices on the network (such as routers, switches, printers, IoTs...).

### MIB

The **MIB** stands for **Management Information Base** and is a **hierarchically organized collection of information**. They are **accessed** using a **protocol** such as **SNMP**. There are two types of MIBs: **scalar** and **tabular**.&#x20;

**Scalar objects** define a single object instance while **tabular objects** define multiple instances of related objects grouped in MIB tables.

### OIDs

OIDs stand for Object Identifiers. **OIDs uniquely identify the managed objects in a MIB hierarchy**. This can be represented as a tree, the levels of which are assigned by different organizations. The top-level MIB object IDs (OIDs) belong to different standard organizations.

{% hint style="success" %}
Vendors define private branches that include managed objects for their own products.
{% endhint %}

![](../../.gitbook/assets/oid\_tree\_example.png)

{% hint style="success" %}
You can **browse an OID tree** from the web [here](https://oidref.com) or **see what an OID** (such as 1.3.6.1.2.1) **means** by accessing [https://oidref.com/1.3.6.1.2.1](https://oidref.com/1.3.6.1.2.1). There are some well-known OIDs such as those within [1.3.6.1.2.1](https://oidref.com/1.3.6.1.2.1) that reference variables defined by the Simple Network Management Protocol (SNMP) MIB-2. And from the **pending OIDs of this** you can get some interesting host data (system data, network data, process data, etc.).
{% endhint %}

### OID Example

{% embed url="https://www.netadmintools.com/snmp-mib-and-oids#OID" %}

### SNMP Versions

There are 2 major versions of SNMP:

* **SNMPv1**: The main one, still the most frequent, **authentication is based on a string** (community string) that travels in **plain text** (all information travels in plain text). **Version 2 and 2c** send the **traffic in plain text** as well and use a **community string as authentication**.
* **SNMPv3**: Uses a better form of authentication and the information travels **encrypted** using (a **dictionary attack** could be performed but it would be much more difficult to find the correct credentials than in SNMPv1 and v2).

### Community Strings

As mentioned above, **in order to access the information stored in the MIB it is necessary to know the community string in versions 1 and 2/2c and the credentials in version 3.**. There are **2 types of community strings**:

* **public** mainly read-only functions.
* **private** are generally **read/write**.

Note that **the writability of an OID depends on the community string used**, so **even** if you find that "**public**" is being used, you might be able to **write some values.** Also, **there may be objects** that are **always read-only**.

If you try to **write** an object, you may receive a **noSuchName** or **readOnly** error.

In versions 1 and 2/2c if you use a **bad community string,** the server does not **respond**. Therefore, if it responds, a **valid community string** has been used.

### Ports

The SNMP agent receives requests on UDP port **161**.

The manager receives notifications ([Traps](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#Trap) and [InformRequests](https://en.wikipedia.org/wiki/Simple\_Network\_Management\_Protocol#InformRequest)) on port **162**.

When used with [Transport Layer Security](https://en.wikipedia.org/wiki/Transport\_Layer\_Security) or [Datagram Transport Layer Security](https://en.wikipedia.org/wiki/Datagram\_Transport\_Layer\_Security), requests are received on port **10161** and notifications are sent to port **10162**.

### Devices

One of the first things I do is extract the sysDesc .1.3.6.1.2.1.1.1.0 MIB data from each file to determine what devices I have harvested information from. This can easily be done using the following grep command:

```bash
grep ".1.3.6.1.2.1.1.1.0" *.snmp
```

### Identify private string

As an example, if I can identify the private community string used by an organization on their Cisco IOS routers, then I could possibly use that community string to extract the running configurations from those routers. The best method for finding such data has often been related to SNMP Trap data. So again, using the following grep we can parse through a lot of MIB data quickly searching for the key word of “trap”:

```bash
grep -i "trap" *.snmp
```

### Usernames/passwords

Another area of interest is logs, I have discovered that there are some devices that hold logs within the MIB tables. These logs can also contain failed logon attempts. Think about the last time you logged into a device via Telnet or SSH and inadvertently entered your password as the username. I typically search for key words such as fail, failed or login and examine that data to see if there is anything of value.

```bash
grep -i "login\|fail" *.snmp
```

### Emails

```bash
grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
```

### Modifying SNMP values

You can use **NetScanTools** to **modify values**. You will need to know the **private string** in order to do so.

### Spoofing

If there is an ACL that only allows some IPs to query the SMNP service, you can spoof one of this addresses inside the UDP packet an sniff the traffic.
